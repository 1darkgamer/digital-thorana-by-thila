<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Digital thorana</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow:hidden}
    body{
      height:100vh;
      background:#000;
      font-family: Arial, Helvetica, sans-serif;
      color:#fff;
      position: relative;
      overscroll-behavior: none;
      -webkit-overflow-scrolling: touch;
    }
    .bg{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    .bg img{
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      min-width: 100vw;
      min-height: 100vh;
      width: auto;
      height: auto;
      object-fit: cover;
      -webkit-user-drag:none;
      user-drag:none;
      user-select:none;
      pointer-events:none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
    }
    .controls{
      position:fixed;
      top:12px;
      right:12px;
      z-index:10;
      display:flex;
      gap:8px;
      background:rgba(0,0,0,0.35);
      padding:6px;
      border-radius:8px;
      backdrop-filter: blur(10px);
    }
    .controls button{
      border:1px solid rgba(255,255,255,0.12);
      background:transparent;
      color:#fff;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .controls button:active{
      background:rgba(255,255,255,0.1);
      transform: scale(0.95);
    }
    #tapOverlay{
      position:fixed;
      inset:0;
      z-index:20;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.65);
      text-align:center;
      padding:24px;
      gap:12px;
      flex-direction:column;
      font-size:18px;
      backdrop-filter: blur(5px);
    }
    #tapOverlay.hidden{display:none}
    #tapOverlay button{
      padding:12px 20px;
      border-radius:8px;
      background:#1f8ef1;
      color:#fff;
      border:none;
      font-size:16px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      transition: all 0.2s ease;
    }
    #tapOverlay button:active{
      transform: scale(0.95);
      background:#1a7fd4;
    }

    /* Hide the hint div */
    .hint {
      display: none !important;
    }

    /* Snow container */
    #snow {
      pointer-events: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100vh;
      z-index: 15;
      overflow: visible;
    }
    .snowflake {
      position: absolute;
      top: -10px;
      background: white;
      border-radius: 50%;
      opacity: 0.8;
      filter: drop-shadow(0 0 2px #fff);
      animation-name: fall;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      will-change: transform;
    }
    @keyframes fall {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0.8;
      }
      100% {
        transform: translateY(100vh) translateX(20px);
        opacity: 0.2;
      }
    }

    /* Fog layers */
    #fog1, #fog2 {
      position: fixed;
      top: 0; left: 0;
      width: 150%;
      height: 150%;
      pointer-events: none;
      z-index: 12;
      background: radial-gradient(circle, rgba(255,255,255,0.12) 30%, transparent 70%);
      filter: blur(30px);
      opacity: 0.15;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      will-change: transform;
    }
    #fog1 {
      animation-name: fogMove1;
      animation-duration: 60s;
      animation-direction: alternate;
    }
    #fog2 {
      animation-name: fogMove2;
      animation-duration: 90s;
      animation-direction: alternate;
      background: radial-gradient(circle, rgba(255,255,255,0.08) 30%, transparent 70%);
      filter: blur(40px);
      opacity: 0.1;
      top: -10%;
      left: -10%;
    }

    @keyframes fogMove1 {
      0% { transform: translateX(0) translateY(0) scale(1); }
      100% { transform: translateX(30px) translateY(20px) scale(1.05); }
    }
    @keyframes fogMove2 {
      0% { transform: translateX(0) translateY(0) scale(1); }
      100% { transform: translateX(-40px) translateY(30px) scale(1.1); }
    }

    /* README link styling */
    #readme-link {
      position: fixed;
      bottom: 12px;
      right: 12px;
      z-index: 30;
      background: rgba(0,0,0,0.5);
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 14px;
      text-decoration: none;
      transition: background-color 0.3s ease;
      -webkit-tap-highlight-color: transparent;
      backdrop-filter: blur(10px);
    }
    #readme-link:hover, #readme-link:active {
      background: rgba(31,142,241,0.8);
      color: #fff;
    }

    /* Mobile Responsive Styles */
    @media (max-width: 768px) {
      html, body {
        width: 100vw;
        height: 100vh;
        height: -webkit-fill-available;
        overflow: hidden;
        position: fixed;
      }
      
      body {
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        height: -webkit-fill-available;
        overscroll-behavior: none;
      }
      
      .bg {
        width: 100vw;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        height: -webkit-fill-available;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
      }
      
      .bg img {
        position: absolute !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        min-width: 102vw !important;
        min-height: 102vh !important;
        min-height: calc(var(--vh, 1vh) * 102) !important;
        width: auto !important;
        height: auto !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: cover !important;
        object-position: center center !important;
      }
      
      /* Alternative fallback */
      .bg img {
        width: 102vw !important;
        height: 102vh !important;
        height: calc(var(--vh, 1vh) * 102) !important;
      }
      
      .controls {
        top: 8px;
        right: 8px;
        gap: 6px;
        padding: 4px;
        border-radius: 6px;
        position: fixed;
        z-index: 100;
      }
      
      .controls button {
        padding: 8px 12px;
        font-size: 12px;
        border-radius: 4px;
        min-width: 44px;
        min-height: 44px;
      }
      
      #tapOverlay {
        font-size: 16px;
        padding: 20px 16px;
        gap: 16px;
      }
      
      #tapOverlay button {
        font-size: 16px;
        padding: 14px 24px;
        min-width: 200px;
        min-height: 48px;
        border-radius: 12px;
      }
      
      #readme-link {
        bottom: 8px;
        right: 8px;
        font-size: 12px;
        padding: 8px 12px;
        border-radius: 6px;
        min-height: 36px;
        display: flex;
        align-items: center;
      }
      
      .snowflake {
        width: 3px !important;
        height: 3px !important;
      }
      
      #fog1, #fog2 {
        opacity: 0.06;
        filter: blur(20px);
      }
      
      #snow {
        height: 100vh;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 480px) {
      .bg {
        position: fixed !important;
        inset: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        height: -webkit-fill-available !important;
      }
      
      .bg img {
        position: absolute !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        min-width: 103vw !important;
        min-height: 103vh !important;
        min-height: calc(var(--vh, 1vh) * 103) !important;
        width: 103vw !important;
        height: 103vh !important;
        height: calc(var(--vh, 1vh) * 103) !important;
        object-fit: cover !important;
        object-position: center !important;
      }
      
      .controls button {
        padding: 6px 10px;
        font-size: 11px;
        min-width: 40px;
        min-height: 40px;
      }
      
      #tapOverlay {
        font-size: 14px;
        padding: 16px 12px;
      }
      
      #tapOverlay button {
        font-size: 14px;
        padding: 12px 20px;
        min-width: 180px;
        min-height: 44px;
      }
      
      #readme-link {
        font-size: 11px;
        padding: 6px 10px;
        min-height: 32px;
      }
      
      .snowflake {
        width: 2px !important;
        height: 2px !important;
      }
    }

    /* Landscape orientation for mobile */
    @media (max-width: 768px) and (orientation: landscape) {
      .bg {
        width: 100vw !important;
        height: 100vh !important;
        height: -webkit-fill-available !important;
      }
      
      .bg img {
        position: absolute !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        min-width: 102vw !important;
        min-height: 102vh !important;
        width: 102vw !important;
        height: 102vh !important;
        object-fit: cover !important;
        object-position: center !important;
      }
      
      .controls {
        top: 6px;
        right: 6px;
      }
      
      #readme-link {
        bottom: 6px;
        right: 6px;
      }
    }

    /* Tablet styles */
    @media (min-width: 769px) and (max-width: 1024px) {
      #tapOverlay {
        font-size: 17px;
      }
      #readme-link {
        font-size: 13px;
      }
    }

    /* Prevent zoom on double tap */
    * {
      touch-action: manipulation;
    }

    /* iOS specific fixes */
    @supports (-webkit-touch-callout: none) {
      body {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: none;
      }
      
      .bg img {
        -webkit-user-select: none;
        -webkit-touch-callout: none;
      }
    }
  </style>
</head>
<body>

  <div class="bg">
    <img id="theGif" src="sdf3.gif" alt="Background GIF" draggable="false">
  </div>

  <audio id="bgAudio" preload="metadata" loop>
    <source src="angulimala.m4a" type="audio/mp4">
    <source src="angulimala.mp3" type="audio/mpeg">
    <source src="angulimala.ogg" type="audio/ogg">
    Your browser does not support the audio element.
  </audio>

  <div class="controls" aria-hidden>
    <button id="playBtn">Play</button>
    <button id="pauseBtn">Pause</button>
    <button id="muteBtn">Mute</button>
  </div>

  <div id="tapOverlay" class="hidden" role="dialog" aria-modal="true">
    <div>Autoplay blocked by browser.<br>කතා වස්තුව ශ්‍රවනය කිරීමට මෙතන ටැප් කරන්න.</div>
    <button id="tapToPlay">Tap to Play</button>
    <small style="opacity:0.9">(ඔබට අවශ්‍යනම් mute කරලා play කරන්න.)</small>
  </div>

  <!-- Hidden hint div -->
  <div class="hint">Long-press / right-click disabled.</div>

  <!-- Snow container -->
  <div id="snow"></div>

  <!-- Fog layers -->
  <div id="fog1"></div>
  <div id="fog2"></div>

  <!-- README link -->
  <a href="readme.html" id="readme-link" target="_blank" rel="noopener noreferrer">README පිටුවට යන්න</a>

  <script>
    // Prevent right-click / drag / select
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('dragstart', e => e.preventDefault());
    document.addEventListener('selectstart', e => e.preventDefault());

    // Prevent zoom on iOS
    document.addEventListener('gesturestart', e => e.preventDefault());
    document.addEventListener('gesturechange', e => e.preventDefault());
    document.addEventListener('gestureend', e => e.preventDefault());

    // Prevent scroll bounce on iOS
    document.addEventListener('touchstart', e => {
      if (e.touches.length > 1) {
        e.preventDefault();
      }
    });

    document.addEventListener('touchmove', e => {
      e.preventDefault();
    }, { passive: false });

    const audio = document.getElementById('bgAudio');
    const overlay = document.getElementById('tapOverlay');
    const tapBtn = document.getElementById('tapToPlay');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const muteBtn = document.getElementById('muteBtn');
    const snowContainer = document.getElementById('snow');

    audio.volume = 0.7;

    function tryAutoPlay() {
      // Check if audio can be played
      if (audio.readyState >= 2) {
        audio.play().then(() => {
          console.log('Audio playing automatically');
          overlay.classList.add('hidden');
        }).catch(error => {
          console.log('Autoplay failed:', error);
          overlay.classList.remove('hidden');
        });
      } else {
        // Wait for audio to load
        audio.addEventListener('canplaythrough', () => {
          audio.play().then(() => {
            overlay.classList.add('hidden');
          }).catch(() => {
            overlay.classList.remove('hidden');
          });
        }, { once: true });
        overlay.classList.remove('hidden');
      }
    }

    function userStartPlayback() {
      audio.currentTime = 0; // Reset to beginning
      audio.play().then(() => {
        console.log('Audio started by user interaction');
        overlay.classList.add('hidden');
      }).catch(error => {
        console.error('Audio play failed:', error);
        alert('Audio play කරන්න බැරි වුණා. File එක check කරන්න.');
      });
    }

    function addGestureListeners() {
      const start = (e) => {
        e.preventDefault();
        userStartPlayback();
        window.removeEventListener('click', start);
        window.removeEventListener('touchstart', start);
        window.removeEventListener('keydown', start);
      };
      window.addEventListener('click', start, { once: true, passive: false });
      window.addEventListener('touchstart', start, { once: true, passive: false });
      window.addEventListener('keydown', start, { once: true });
    }

    // Enhanced button event listeners
    tapBtn.addEventListener('click', (e) => {
      e.preventDefault();
      userStartPlayback();
    });
    tapBtn.addEventListener('touchend', (e) => {
      e.preventDefault();
      userStartPlayback();
    });
    
    playBtn.addEventListener('click', () => {
      audio.play().then(() => {
        console.log('Play button clicked - audio started');
      }).catch(error => {
        console.error('Play failed:', error);
        alert('Play කරන්න බැරි වුණා');
      });
    });
    
    pauseBtn.addEventListener('click', () => {
      audio.pause();
      console.log('Audio paused');
    });
    
    muteBtn.addEventListener('click', () => {
      audio.muted = !audio.muted;
      muteBtn.textContent = audio.muted ? 'Unmute' : 'Mute';
      console.log('Audio muted:', audio.muted);
    });

    // Audio event listeners for debugging
    audio.addEventListener('loadstart', () => console.log('Audio loading started'));
    audio.addEventListener('canplay', () => console.log('Audio can start playing'));
    audio.addEventListener('canplaythrough', () => console.log('Audio can play through'));
    audio.addEventListener('error', (e) => {
      console.error('Audio error:', e);
      alert('Audio file load කරන්න බැරි වුණා. angulimala.m4a file එක තිබෙනවද check කරන්න.');
    });
    audio.addEventListener('play', () => console.log('Audio started playing'));
    audio.addEventListener('pause', () => console.log('Audio paused'));
    audio.addEventListener('ended', () => console.log('Audio ended'));

    // Create snowflakes with mobile optimization
    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      
      // Adjust snowflake size based on screen size
      const isMobile = window.innerWidth <= 768;
      const baseSize = isMobile ? 3 : 7;
      const sizeVariation = isMobile ? 2 : 5;
      const size = Math.random() * sizeVariation + baseSize;
      
      snowflake.style.width = size + 'px';
      snowflake.style.height = size + 'px';
      snowflake.style.left = Math.random() * 100 + 'vw';
      
      const duration = Math.random() * 9 + 6;
      snowflake.style.animationDuration = duration + 's';
      snowflake.style.animationDelay = '-' + Math.random() * duration + 's';

      snowContainer.appendChild(snowflake);

      setTimeout(() => {
        if (snowflake && snowflake.parentNode) {
          snowflake.remove();
        }
      }, duration * 1000);
    }

    function snowFall() {
      createSnowflake();
      // Reduce snowflake frequency on mobile for better performance
      const isMobile = window.innerWidth <= 768;
      const interval = isMobile ? 200 : 150;
      setTimeout(snowFall, interval);
    }

    // Handle orientation changes
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        // Force a repaint after orientation change
        document.body.style.display = 'none';
        document.body.offsetHeight; // Trigger reflow
        document.body.style.display = '';
      }, 100);
    });

    // Handle resize events
    window.addEventListener('resize', () => {
      // Update viewport height for mobile browsers
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
      
      // Force image to fill screen completely
      const img = document.getElementById('theGif');
      if (img && window.innerWidth <= 768) {
        // Mobile specific adjustments
        img.style.position = 'absolute';
        img.style.top = '50%';
        img.style.left = '50%';
        img.style.transform = 'translate(-50%, -50%)';
        img.style.minWidth = '102vw';
        img.style.minHeight = '102vh';
        img.style.width = '102vw';
        img.style.height = '102vh';
        img.style.objectFit = 'cover';
        img.style.objectPosition = 'center';
      }
    });

    // Initialize
    window.addEventListener('load', () => {
      // Set viewport height
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
      
      // Mobile specific image setup
      const img = document.getElementById('theGif');
      if (img && window.innerWidth <= 768) {
        setTimeout(() => {
          img.style.position = 'absolute';
          img.style.top = '50%';
          img.style.left = '50%';
          img.style.transform = 'translate(-50%, -50%)';
          img.style.minWidth = '102vw';
          img.style.minHeight = '102vh';
          img.style.width = '102vw';
          img.style.height = '102vh';
          img.style.objectFit = 'cover';
          img.style.objectPosition = 'center';
        }, 100);
      }
      
      tryAutoPlay();
      addGestureListeners();
      snowFall();
    });

    // Prevent context menu on long press for mobile
    let longPressTimer;
    document.addEventListener('touchstart', (e) => {
      longPressTimer = setTimeout(() => {
        e.preventDefault();
      }, 500);
    });

    document.addEventListener('touchend', () => {
      clearTimeout(longPressTimer);
    });

    document.addEventListener('touchcancel', () => {
      clearTimeout(longPressTimer);
    });
  </script>

</body>
</html>
